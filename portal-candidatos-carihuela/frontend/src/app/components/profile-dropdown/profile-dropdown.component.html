<div class="relative">
    <button (click)="toggleDropdown()"
        class="flex items-center justify-center w-10 h-10 bg-slate-100 rounded-full text-slate-600 hover:bg-slate-200 active:scale-95 focus:outline-none transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
    </button>

    @if (isOpen()) {
    <!-- Backdrop with blur for mobile focus -->
    <div class="fixed inset-0 z-10 bg-slate-900/20 backdrop-blur-sm sm:bg-transparent sm:backdrop-blur-none"
        (click)="toggleDropdown()"></div>

    <!-- Dropdown Menu: Fixed centered on mobile, absolute on desktop -->
    <div
        class="fixed inset-x-4 top-20 sm:absolute sm:inset-auto sm:right-0 sm:mt-2 sm:w-64 bg-white rounded-2xl shadow-2xl ring-1 ring-black ring-opacity-5 z-20 overflow-hidden transform origin-top transition-all">
        <div class="p-2 space-y-1">
            <button (click)="onPrivacyPolicy()"
                class="w-full flex items-center px-4 py-4 sm:py-3 text-sm font-medium text-slate-700 hover:bg-slate-50 active:bg-slate-100 rounded-xl transition-colors">
                <svg class="h-5 w-5 mr-3 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path
                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 20.417l4.5-4.5M12 14a3 3 0 100-6 3 3 0 000 6z"
                        stroke-width="2" />
                </svg>
                {{ t().profileDropdown.privacyPolicy }}
            </button>

            <button (click)="onLogout()"
                class="w-full flex items-center px-4 py-4 sm:py-3 text-sm font-medium text-red-600 hover:bg-red-50 active:bg-red-100 rounded-xl transition-colors">
                <svg class="h-5 w-5 mr-3 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                        stroke-width="2" />
                </svg>
                {{ t().profileDropdown.logout }}
            </button>
        </div>

        <div class="bg-slate-50 p-4 border-t border-slate-100">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3">{{
                t().profileDropdown.language }}</p>
            <div class="flex gap-2 bg-white p-1 rounded-xl border border-slate-200">
                <button (click)="setLanguage('en')"
                    [class]="'flex-1 py-2.5 sm:py-1.5 text-xs font-bold rounded-lg transition-all ' + (currentLanguage() === 'en' ? 'bg-[#003366] text-white shadow-sm' : 'text-slate-500 hover:bg-slate-50')">
                    EN
                </button>
                <button (click)="setLanguage('es')"
                    [class]="'flex-1 py-2.5 sm:py-1.5 text-xs font-bold rounded-lg transition-all ' + (currentLanguage() === 'es' ? 'bg-[#003366] text-white shadow-sm' : 'text-slate-500 hover:bg-slate-50')">
                    ES
                </button>
            </div>
        </div>
    </div>
    }
</div>