<div class="min-h-screen bg-slate-50 p-4 sm:p-6 lg:p-8 flex flex-col items-center justify-center">

    @if (examState() !== 'in_progress') {
    <div class="w-full max-w-3xl mb-4">
        <button (click)="navigateToDocuments()"
            class="flex items-center text-slate-500 hover:text-slate-800 transition-colors font-medium text-sm group">
            <svg xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 mr-2 transform group-hover:-translate-x-1 transition-transform" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            {{ t().exam.backToDocs }}
        </button>
    </div>
    }

    <div
        class="w-full max-w-3xl bg-white p-8 sm:p-12 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden">

        @switch (examState()) {
        @case ('loading') {
        <div class="flex flex-col items-center justify-center h-64">
            <app-loading-spinner size="lg"></app-loading-spinner>
        </div>
        }

        @case ('not_started') {
        <div class="text-center py-4">
            <div
                class="flex justify-center items-center mx-auto h-20 w-20 rounded-full bg-slate-50 mb-8 border border-slate-100 text-[#003366]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 tracking-tight">{{ t().exam.title }}</h1>
            <h2 class="text-lg font-medium text-slate-500 mt-2">{{ t().exam.startTitle }}</h2>
            <p class="text-slate-400 mt-4 max-w-md mx-auto leading-relaxed">
                {{ t().exam.startDescription.replace('{count}', '' + examConstants.count).replace('{seconds}', '' +
                examConstants.seconds) }}
            </p>
            <div class="mt-10">
                <button (click)="startExam()"
                    class="w-full sm:w-auto inline-flex justify-center items-center py-4 px-10 rounded-xl shadow-md text-lg font-bold text-white bg-[#003366] hover:bg-[#002244] transition-all transform active:scale-95">
                    {{ t().exam.startExam }}
                </button>
            </div>
        </div>
        }

        @case ('in_progress') {
        @if (currentQuestion(); as question) {
        <div>
            <div class="mb-10">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <span
                            class="text-xs font-bold uppercase tracking-wider text-slate-400 block mb-1">Progreso</span>
                        <p class="text-sm font-bold text-[#003366]">
                            {{ t().exam.questionOf.replace('{current}', '' + (currentQuestionIndex() +
                            1)).replace('{total}', '' +
                            questions().length) }}
                        </p>
                    </div>
                    <div
                        class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-lg text-sm font-bold text-slate-700 border border-slate-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[#003366]" fill="none"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <span>{{ timer() }}s</span>
                    </div>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden border border-slate-200">
                    <div class="bg-[#003366] h-full rounded-full transition-all duration-500 ease-out"
                        [style.width.%]="progress()"></div>
                </div>
            </div>

            <div class="min-h-[100px] flex items-center justify-center mb-10 text-center px-2">
                <h2 class="text-2xl font-bold text-slate-800 leading-tight">{{ question.text }}</h2>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                @for (option of question.options; track option) {
                <button (click)="selectAnswer(option)"
                    class="group w-full text-left p-5 border-2 border-slate-100 rounded-xl hover:bg-slate-50 hover:border-[#003366]/30 focus:outline-none focus:ring-2 focus:ring-[#003366] transition-all duration-200 flex justify-between items-center">
                    <span class="text-md font-semibold text-slate-700 group-hover:text-[#003366] transition-colors">{{
                        option
                        }}</span>
                    <div
                        class="h-5 w-5 rounded-full border-2 border-slate-200 group-hover:border-[#003366] transition-colors flex items-center justify-center">
                        <div
                            class="h-2 w-2 bg-[#003366] rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                    </div>
                </button>
                }
            </div>
        </div>
        }
        }

        @case ('finished') {
        @if(examResult(); as result) {
        <div class="text-center py-6">
            <div
                [class]="'flex justify-center items-center mx-auto h-20 w-20 rounded-full mb-6 shadow-sm border ' + (result.passed ? 'bg-green-50 border-green-100 text-green-600' : 'bg-red-50 border-red-100 text-red-600')">
                @if (result.passed) {
                <svg class="h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
                } @else {
                <svg class="h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
                }
            </div>

            <h1 class="text-3xl font-bold text-slate-800 tracking-tight">{{ t().exam.completedTitle }}</h1>
            <p class="text-lg text-slate-500 mt-3">
                {{ t().exam.score.replace('{correct}', '' + result.score).replace('{total}', '' + result.total) }}
            </p>
            <div
                [class]="'inline-block mt-4 px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-widest border ' + (result.passed ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200')">
                {{ result.passed ? t().exam.result.passed : t().exam.result.failed }}
            </div>

            <div class="mt-12 flex flex-col sm:flex-row gap-4 justify-center">
                @if (result.passed) {
                <button (click)="navigateToDocuments()"
                    class="w-full sm:w-auto inline-flex items-center justify-center py-4 px-10 rounded-xl shadow-md text-base font-bold text-white bg-slate-700 hover:bg-slate-800 transition-all">
                    {{ t().exam.backToDocs }}
                </button>
                } @else {
                <button (click)="startExam()"
                    class="w-full sm:w-auto inline-flex items-center justify-center py-4 px-10 rounded-xl shadow-md text-base font-bold text-white bg-[#003366] hover:bg-[#002244] transition-all">
                    {{ t().exam.tryAgain }}
                </button>
                }
            </div>
        </div>
        }
        }

        @case ('already_passed') {
        <div class="text-center py-10">
            <div
                class="flex justify-center items-center mx-auto h-20 w-20 rounded-full bg-blue-50 border border-blue-100 text-blue-600 mb-8 shadow-sm">
                <svg class="h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 tracking-tight">{{ t().exam.alreadyPassedTitle }}</h1>
            <p class="text-lg text-slate-500 mt-4 max-w-sm mx-auto leading-relaxed">{{ t().exam.alreadyPassedDescription
                }}
            </p>
            <div class="mt-12">
                <button (click)="navigateToDocuments()"
                    class="w-full sm:w-auto inline-flex items-center justify-center py-4 px-12 rounded-xl shadow-md text-base font-bold text-white bg-slate-700 hover:bg-slate-800 transition-all transform active:scale-95">
                    {{ t().exam.backToDocs }}
                </button>
            </div>
        </div>
        }
        }
    </div>

    <p class="mt-8 text-slate-400 text-xs uppercase tracking-[0.2em] font-medium">
        Â© 2026 La Carihuela
    </p>
</div>